
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sqitch on Target - theory.so</title>
  <meta name="author" content="David E. Wheeler">

  
  <meta name="description" content="At the end of the day last week, I released Sqitch v0.990. This was a
pretty big release, with lots of changes. The most awesome addition, in my &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://theory.so/sqitch/2014/01/09/sqitch-on-target">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="theory.so" type="application/atom+xml">
  

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43606412-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h2><a href="/"><img src="/images/logo.png" alt="≡" /></a></h2>
  <h1><a href="/">theory.so</a></h1>
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:theory.so" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="http://pgxn.org/user/theory">PGXN</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>










<article class="hentry" role="article" >
  
  <header>
    <h1 class="entry-title">

Sqitch on Target

</h1>

    
      <p class="meta">
        








  


<time datetime="2014-01-09T15:27:00-08:00" pubdate data-updated="true"> 9 January 2014</time>
        
         &bull; <a rel="bookmark" href="/sqitch/2014/01/09/sqitch-on-target/">§</a>
      </p>
    
  </header>



  <div class="entry-content"><p>At the end of the day last week, I released <a href="http://sqitch.org/">Sqitch</a> v0.990. This was a
pretty big release, with lots of changes. The most awesome addition, in my
opinion, is <em>Named Deployment targets.</em></p>

<p>In previous versions of Sqitch, one
could set default values for the database to deploy to, but needed to use the
<code>--db-*</code> options to deploy to another database. This was fine for
development: just set the default on <code>localhost</code> and go. But when it came
time to deploy to other servers for testing, QA, or production, it was a bit
of a PITA. At <a href="http://www.iovation.com/">work</a>, I ended up writing deployment docs that defined a slew
of environment variables, and our operations team needed to adjust those
variables to deploy to various servers. It was ugly, and frankly a bit of a
pain in the ass.</p>

<p>I thought it&rsquo;d be better to have named deployment targets, so instead of
changing a bunch of environment variables in order to set a bunch of options,
we could just name a target and go. I borrowed the idea from <a href="http://git-scm.com/docs/git-remote">Git remotes</a>,
and started a <a href="https://github.com/theory/uri-db">database URI spec</a> (mentioned <a href="/rfc/2013/11/26/toward-a-database-uri-standard/">previously</a>) to simplify things
a bit. Here&rsquo;s how it works. Say you have a PostgreSQL Sqitch project called
&ldquo;Flipr&rdquo;. While doing development, you&rsquo;ll want to have a local database to
deploy to. There is also a QA database and a production database. Use the
<a href="https://metacpan.org/pod/sqitch-target"><code>target</code></a> command to set them up:</p>

<figure class='code'><figcaption><span>Sqitch Targeting</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch target add dev db:pg:flipr
</span><span class='line'>sqitch target add qa db:pg://sqitch@qa.example.com/flipr
</span><span class='line'>sqitch target add prod db:pg://sqitch@db.example.com/flipr
</span></code></pre></td></tr></table></div></figure>


<p>Like <a href="http://git-scm.com/docs/git-remote">Git remotes</a>, we just have names and URIs. To <a href="https://metacpan.org/pod/sqitch-deploy"><code>deploy</code></a> to a database,
just name it:</p>

<figure class='code'><figcaption><span>Deploy to Dev</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch deploy dev
</span></code></pre></td></tr></table></div></figure>


<p>Want to deploy to QA? Name it:</p>

<figure class='code'><figcaption><span>Deploy to QA</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch deploy qa
</span></code></pre></td></tr></table></div></figure>


<p>This works with any of the commands that connect to a database, including
<a href="https://metacpan.org/pod/sqitch-revert"><code>revert</code></a> and <a href="https://metacpan.org/pod/sqitch-status"><code>status</code></a>:</p>

<figure class='code'><figcaption><span>Targeted revert, Status</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch revert --to @HEAD^^ dev
</span><span class='line'>sqitch status prod
</span></code></pre></td></tr></table></div></figure>


<p>The great thing about this feature is that the configuration is all stored
in the project Sqitch configuration file. That means you can commit all the
connection URIs for all likely targets in directly to the project repository.
If they change, just change them in the config, commit, and push.</p>

<p>Targets don&rsquo;t always have to be configured in advance, of course. The names
essentially stand in for the URIs, so you can connect to an unnamed target
just by using a URI:</p>

<figure class='code'><figcaption><span>URI Targeting</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch log db:postgres://db1.example.net/flipr_export
</span></code></pre></td></tr></table></div></figure>


<p>Of course there are still defaults specific to each engine. I generally like
to set the &ldquo;dev&rdquo; target as the default deploy target, like so:</p>

<figure class='code'><figcaption><span>Configure Default Target</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch config core.pg.target dev
</span></code></pre></td></tr></table></div></figure>


<p>This sets the &ldquo;dev&rdquo; target as the default for the PostgreSQL engine. So now I
can do stuff with the &ldquo;dev&rdquo; target without mentioning it at all:</p>

<figure class='code'><figcaption><span>Rebase Dev Target</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sqitch rebase --onto HEAD^4
</span></code></pre></td></tr></table></div></figure>


<p>Named targets may also have a couple other attributes associated with them:</p>

<ul>
<li><code>client</code>: The command-line client to use for a target.</li>
<li><code>registry</code>: The name of the Sqitch registry schema or database, which defaults to, simply, <code>sqitch</code>.</li>
</ul>


<p>Now that I&rsquo;ve started using it, I can think of other things I&rsquo;d like to add to targets in the future, including:</p>

<ul>
<li><a href="https://github.com/theory/sqitch/issues/143">Setting other attributes</a>, such as the deployment mode, whether to verify changes, and variables.</li>
<li><a href="https://github.com/theory/sqitch/issues/135">Allowing multiple URIs</a>, for concurrent database deployments!</li>
</ul>


<p>Pretty cool stuff ahead, IMO. I&rsquo;m grateful to <a href="http://www.iovation.com/">work</a> for letting me hack on
Sqitch.</p>
</div>


  <footer>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://theory.so/sqitch/2014/01/09/sqitch-on-target/" data-via="theory" data-counturl="http://theory.so/sqitch/2014/01/09/sqitch-on-target/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="false" data-layout="button_count" data-width="200" data-show-faces="false"></div>
  
  
  <span class="adn-post"><a href="https://alpha.app.net/intent/post/?url=/sqitch/2014/01/09/sqitch-on-target/&text=theory.so: “Sqitch on Target”" class="adn-button" target="_blank" data-type="share" data-width="132" data-height="20" data-text="theory.so: “Sqitch on Target”" data-url="/sqitch/2014/01/09/sqitch-on-target/" >Share on App.net</a></span>
  <script>(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//d2zh9g63fcvyrq.cloudfront.net/adn.js";fjs.parentNode.insertBefore(js,fjs);}}(document, "script", "adn-button-js"));</script>
  
</div>

    
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (David E. Wheeler)" rel="author">David E. Wheeler</a></span></span>

      








  


<time datetime="2014-01-09T15:27:00-08:00" pubdate data-updated="true"> 9 January 2014</time>
      

<span class="categories">
  
    <a class='category' href='/categories/sqitch/'>sqitch</a>
  
</span>


    </p>
          <div class="follow_buttons_byline">

  <a href="http://twitter.com/theory" class="twitter-follow-button" data-show-count="true">Follow @theory</a>


   <a href="https://alpha.app.net/intent/follow/?user_id=%40theory" class="adn-button" target="_blank" data-type="follow" data-width="277" data-height="20" data-user-id="@theory" data-show-count="1" data-show-username="1">Follow me on App.net</a>
<script src="//d2zh9g63fcvyrq.cloudfront.net/adn.js"></script>

      </div>

    <p class="meta">
      
        <a class="basic-alignment left" href="/rfc/2013/11/26/toward-a-database-uri-standard/" title="Previous Post: Toward A Database URI Standard">&laquo; Toward A Database URI Standard</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 – David E. Wheeler –
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> –
  <a href="/atom.xml" title="Subscribe to theory.com">Feed</a>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'theoryso';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://theory.so/sqitch/2014/01/09/sqitch-on-target/';
        var disqus_url = 'http://theory.so/sqitch/2014/01/09/sqitch-on-target/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
